<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>低暴露導航系統 (雙北測試版)</title>
  <!-- Leaflet local assets (no CDN) -->
  <link rel="stylesheet" href="vendor/leaflet/leaflet.css" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <!-- 第一行：標題 + 右側按鈕 -->
    <div class="header-row-1">
      <div class="header-left">
        <h1 data-i18n="title">低暴露導航系統 <span class="beta-text">(雙北測試版)</span></h1>
      </div>
            <div class="header-right">
              <button id="help-btn" class="help-btn" data-i18n="helpBtn" title="關於我們 | 說明">
                ❓<span class="help-text">關於我們 | 說明</span>
              </button>
              <div class="language-switcher">
                <button id="btn-lang-en" class="lang-btn" data-i18n="langEN" type="button">EN</button>
                <button id="btn-lang-zh" class="lang-btn" data-i18n="langZH" type="button">中文</button>
              </div>
            </div>
    </div>
    
    <!-- 第二行：模式切換 -->
    <div class="header-row-2">
      <div class="header-logo">
        <img id="main-logo" src="logo/系統logo_橫版.png" alt="系統 Logo" class="main-logo-img">
      </div>
      <div class="header-center">
        <div class="mode-switch">
          <button id="mode-commute" class="mode-btn active" data-i18n="modeCommute">通勤模式</button>
          <button id="mode-metro" class="mode-btn" data-i18n="modeMetro">捷運模式</button>
          <div class="mode-indicator"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- 應用容器 -->
  <div class="app-container">
    <!-- 全屏地圖 -->
    <div id="map" class="fullscreen-map">
    <!-- 地圖圖例 -->
    <div class="map-legend">
      <div class="legend-item">
        <div class="legend-line shortest"></div>
        <span data-i18n="legendShortest">最短路徑</span>
      </div>
      <div class="legend-item">
        <div class="legend-line lowest"></div>
        <span data-i18n="legendLowest">低暴露路徑</span>
      </div>
    </div>

    <!-- 覆蓋層選擇器 -->
    <div class="map-overlay-selector">
      <h4 data-i18n="overlayTitle">覆蓋層</h4>
      <div class="overlay-options">
        <label class="overlay-option">
          <input type="radio" name="overlay" value="none" checked>
          <span data-i18n="overlayNone">無</span>
        </label>
        <label class="overlay-option">
          <input type="radio" name="overlay" value="pm25">
          <span data-i18n="overlayPM25">PM₂.₅</span>
        </label>
        <label class="overlay-option">
          <input type="radio" name="overlay" value="no2">
          <span data-i18n="overlayNO2">NO₂</span>
        </label>
        <label class="overlay-option">
          <input type="radio" name="overlay" value="wbgt">
          <span data-i18n="overlayWBGT">氣溫</span>
        </label>
      </div>
    </div>

    <!-- 底圖選擇器 -->
    <div class="map-tile-selector">
      <button class="tile-selector-button" id="tileSelectorButton">
        <span class="tile-current-name" id="tileCurrentName">底圖樣式</span>
        <span class="tile-dropdown-arrow">▼</span>
      </button>
      <div class="tile-dropdown" id="tileDropdown">
        <div class="tile-option" data-value="cartodb-voyager">淡雅</div>
        <div class="tile-option" data-value="cartodb-light">簡潔</div>
        <div class="tile-option" data-value="cartodb-dark">深色</div>
        <div class="tile-option" data-value="osm">標準</div>
      </div>
    </div>
  </div>

  <!-- 左側功能卡 -->
  <div class="left-panel" id="leftPanel">
    <div class="panel-handle" id="leftPanelHandle">
      <div class="handle-icon">⚙️</div>
      <div class="handle-text" data-i18n="navigationSettings">導航設定</div>
      <div class="handle-arrow">▼</div>
    </div>
    <div class="panel-content">
      <!-- 手機版四行布局 -->
      <div class="mobile-nav-layout">
        <!-- 第一行：起點輸入框 -->
        <div class="nav-row nav-row-1">
          <div class="input-with-label">
            <div class="input-label start-label" data-i18n="startPoint">起點</div>
            <div class="input-with-location-btn">
              <input type="text" id="input-start" class="text-input-mobile" data-i18n-placeholder="startPlaceholderWithIcon" placeholder="🟢 輸入起點地址 / 地標">
              <button class="location-btn" onclick="locateAddress('start')" title="定位" data-i18n="locate">定位</button>
            </div>
          </div>
        </div>

        <!-- 第二行：終點輸入框 -->
        <div class="nav-row nav-row-2">
          <div class="input-with-label">
            <div class="input-label end-label" data-i18n="endPoint">終點</div>
            <div class="input-with-location-btn">
              <input type="text" id="input-end" class="text-input-mobile" data-i18n-placeholder="endPlaceholderWithIcon" placeholder="🔴 輸入終點地址 / 地標">
              <button class="location-btn" onclick="locateAddress('end')" title="定位" data-i18n="locate">定位</button>
            </div>
          </div>
        </div>

        <!-- 第三行：交通方式 -->
        <div class="nav-row nav-row-3">
          <div class="transport-row">
            <label class="transport-label" data-i18n="modeLabel">🚗 交通方式</label>
            <div class="radio-group-mobile">
              <label class="radio-option-mobile">
                <input type="radio" name="transport-mode" value="bicycle" checked>
                <span class="radio-text" data-i18n="modeBicycle">單車</span>
              </label>
              <label class="radio-option-mobile">
                <input type="radio" name="transport-mode" value="walk">
                <span class="radio-text" data-i18n="modeWalk">步行</span>
              </label>
            </div>
          </div>
        </div>

      </div>

      <!-- 桌面版原版布局 -->
      <div class="main-row">
        <!-- 左側：地址輸入 -->
        <div class="address-section">
          <div class="address-group">
            <div class="input-with-coords">
              <div class="input-with-label">
                <div class="input-label start-label" data-i18n="startPoint">起點</div>
                <div class="input-with-location-btn">
                  <input type="text" id="input-start-desktop" class="text-input-compact" data-i18n-placeholder="startPlaceholderWithIcon" placeholder="🟢 輸入起點地址 / 地標">
                  <button class="location-btn" onclick="locateAddress('start-desktop')" title="定位" data-i18n="locate">定位</button>
                </div>
              </div>
              <span id="coords-start-desktop" class="coords-text">-</span>
            </div>
          </div>
          <div class="address-group">
            <div class="input-with-coords">
              <div class="input-with-label">
                <div class="input-label end-label" data-i18n="endPoint">終點</div>
                <div class="input-with-location-btn">
                  <input type="text" id="input-end-desktop" class="text-input-compact" data-i18n-placeholder="endPlaceholderWithIcon" placeholder="🔴 輸入終點地址 / 地標">
                  <button class="location-btn" onclick="locateAddress('end-desktop')" title="定位" data-i18n="locate">定位</button>
                </div>
              </div>
              <span id="coords-end-desktop" class="coords-text">-</span>
            </div>
          </div>
        </div>

        <!-- 中間：交通方式 -->
        <div class="transport-section">
          <div class="transport-row-desktop">
            <label class="transport-label-desktop" data-i18n="modeLabel">🚗 交通方式</label>
            <div class="radio-group-desktop">
              <label class="radio-option-desktop">
                <input type="radio" name="transport-mode-desktop" value="bicycle" checked>
                <span class="radio-text" data-i18n="modeBicycle">單車</span>
              </label>
              <label class="radio-option-desktop">
                <input type="radio" name="transport-mode-desktop" value="walk">
                <span class="radio-text" data-i18n="modeWalk">步行</span>
              </label>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>

  <!-- 導航設定按鈕組 (右下角) -->
  <div class="nav-buttons-group">
    <button id="plan-btn-floating" class="btn btn-primary-floating" data-i18n="planBtn">🔍 規劃路徑</button>
    <button id="reset-btn-floating" class="btn btn-secondary-floating" data-i18n="resetBtn">🔄 重置</button>
  </div>

  <!-- 路徑比較按鈕 (右下角) -->
  <div class="route-comparison-btn disabled" id="routeComparisonBtn" onclick="toggleRouteComparisonModal()">
    <span class="route-btn-icon">📊</span>
    <span class="route-btn-text" data-i18n="routeComparison">路徑比較</span>
  </div>

  <!-- 路徑比較彈窗 -->
  <div class="route-comparison-modal" id="routeComparisonModal">
    <div class="route-modal-content">
      <div class="route-modal-header">
        <h3 data-i18n="routeComparison">路徑比較</h3>
        <button class="close-btn" onclick="closeRouteComparisonModal()">×</button>
      </div>
      <div class="route-modal-body">
        <!-- 視覺化儀表板 -->
        <div class="dashboard-container" id="dashboardContainer">
          <div class="dashboard-grid">
            <!-- 改善效益卡片 -->
            <div class="dashboard-card combined-improvement-card">
              <h4 class="card-title">
                <span data-i18n="improvementBenefit">📊 改善效益</span>
                <button class="help-icon-btn" id="improvementHelpBtn" title="改善率說明">❓</button>
              </h4>
              <div class="horizontal-progress-container">
                <div class="progress-header">
                  <span class="progress-label" data-i18n="exposureImprovement">暴露改善</span>
                  <span class="progress-percentage" id="dashImprovementRate">0%</span>
                </div>
                <div class="progress-bar-container">
                  <div class="progress-bar-background"></div>
                  <div class="progress-bar-fill" id="improvementProgressBar"></div>
                  <div class="progress-bar-glow" id="improvementProgressGlow"></div>
                </div>
                <div class="progress-scale">
                  <span class="scale-label">0%</span>
                  <span class="scale-label">50%</span>
                  <span class="scale-label">100%</span>
                </div>
              </div>
            </div>

            <!-- 距離比較卡片 -->
            <div class="dashboard-card">
              <h4 class="card-title" data-i18n="distanceComparison">📏 距離比較</h4>
              <div class="comparison-bars">
                <div class="bar-item">
                  <div class="bar-header">
                    <span class="route-type shortest" data-i18n="shortest">最短路徑</span>
                    <span class="route-value" id="dashDistanceShortest">-</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill shortest" id="dashDistanceBarShortest"></div>
                  </div>
                </div>
                <div class="bar-item">
                  <div class="bar-header">
                    <span class="route-type lowest" data-i18n="lowest">低暴露路徑</span>
                    <span class="route-value" id="dashDistanceLowest">-</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill lowest" id="dashDistanceBarLowest"></div>
                  </div>
                </div>
              </div>
              <div class="distance-increase-info">
                <span class="increase-label" data-i18n="distanceIncrease">距離增加</span>
                <span class="increase-value" id="dashDistanceIncrease">-</span>
                <span class="increase-unit" id="dashDistanceUnit">公尺</span>
              </div>
            </div>

            <!-- 時間比較卡片 -->
            <div class="dashboard-card">
              <h4 class="card-title" data-i18n="timeComparison">⏱️ 時間比較</h4>
              <div class="comparison-bars">
                <div class="bar-item">
                  <div class="bar-header">
                    <span class="route-type shortest" data-i18n="shortest">最短路徑</span>
                    <span class="route-value" id="dashTimeShortest">-</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill shortest" id="dashTimeBarShortest"></div>
                  </div>
                </div>
                <div class="bar-item">
                  <div class="bar-header">
                    <span class="route-type lowest" data-i18n="lowest">低暴露路徑</span>
                    <span class="route-value" id="dashTimeLowest">-</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill lowest" id="dashTimeBarLowest"></div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div> <!-- 關閉 app-container -->
  
  <!-- 捷運模式面板 -->
  <div id="metro-panel" class="mode-panel" style="display: none;">
    <div class="metro-list-container" id="metro-list-container">
      <div class="metro-container">
        <h2 class="metro-title" data-i18n="metroTitle">🚇 台北捷運路線</h2>
        
        <!-- 路線卡片網格 -->
        <div class="metro-lines-grid">
          <!-- 路線卡片將由 JavaScript 動態生成 -->
        </div>
        
        <!-- 站點彈出層 -->
        <div id="stations-overlay" class="stations-overlay" style="display: none;">
          <div class="stations-modal">
            <div class="stations-header">
              <h3 id="selected-line-name">選擇站點</h3>
              <button id="close-stations" class="close-stations-btn">✕</button>
            </div>
            <div class="stations-grid" id="stations-grid">
              <!-- 站點卡片將由 JavaScript 動態生成 -->
            </div>
          </div>
        </div>
    </div>
  </div>


  <!-- 出口選擇彈窗 -->
    <div id="exit-modal" class="exit-modal" style="display: none;">
      <div class="exit-modal-content">
        <div class="exit-modal-header">
          <h3 id="selected-station-name">象山站</h3>
          <button class="close-exit-modal" onclick="closeExitModal()">✕</button>
        </div>
        <div class="exit-modal-body">
          <div class="selection-container">
            <!-- 左側：出口選擇 -->
            <div class="exit-section">
              <h5 data-i18n="selectExit">選擇出口</h5>
              <div class="exit-buttons" id="exitButtons">
                <button class="exit-btn" data-exit="1" onclick="selectExit(1)">出口1</button>
                <button class="exit-btn" data-exit="2" onclick="selectExit(2)">出口2</button>
                <button class="exit-btn" data-exit="3" onclick="selectExit(3)">出口3</button>
              </div>
            </div>
            
            <!-- 右側：景點選擇 -->
            <div class="attraction-section">
              <h5 data-i18n="nearbyAttractions">附近景點</h5>
              <div class="attraction-buttons" id="attractionButtons">
                <!-- 景點按鈕會動態生成 -->
              </div>
            </div>
          </div>
          
          <!-- 導航按鈕 -->
          <div class="navigation-section">
            <button id="navigationBtn" class="nav-btn" disabled onclick="startNavigation()" data-i18n="startNavigation">開始導航</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 路徑解算結果彈窗 -->
  <div id="route-result-modal" class="route-result-modal" style="display: none;">
    <div class="route-result-content">
      <div class="route-result-header">
        <h3 id="routeResultTitle">路徑解算結果</h3>
        <button class="close-route-result" onclick="closeRouteResultModal()">✕</button>
      </div>
      <div class="route-result-body">
        <!-- 路線地圖 -->
        <div class="route-map-container">
          <div id="route-result-map" class="route-result-map"></div>
        </div>
        
        <!-- 視覺化儀表板 -->
        <div class="result-dashboard-container" id="resultDashboardContainer">
          <div class="result-dashboard-grid">
            <!-- 改善效益卡片 -->
            <div class="result-dashboard-card result-combined-improvement-card">
              <h4 class="card-title">
                <span data-i18n="improvementBenefit">📊 改善效益</span>
                <button class="help-icon-btn" id="resultImprovementHelpBtn" title="改善率說明">❓</button>
              </h4>
              <div class="horizontal-progress-container">
                <div class="progress-header">
                  <span class="progress-label" data-i18n="exposureImprovement">暴露改善</span>
                  <span class="progress-percentage" id="resultDashImprovementRate">0%</span>
                </div>
                <div class="progress-bar-container">
                  <div class="progress-bar-background"></div>
                  <div class="progress-bar-fill" id="resultImprovementProgressBar"></div>
                  <div class="progress-bar-glow" id="resultImprovementProgressGlow"></div>
                </div>
                <div class="progress-scale">
                  <span class="scale-label">0%</span>
                  <span class="scale-label">50%</span>
                  <span class="scale-label">100%</span>
                </div>
              </div>
            </div>

            <!-- 距離比較卡片 -->
            <div class="result-dashboard-card">
              <h4 class="card-title" data-i18n="distanceComparison">📏 距離比較</h4>
              <div class="comparison-bars">
                <div class="bar-item">
                  <div class="bar-header">
                    <span class="route-type shortest" data-i18n="shortest">最短路徑</span>
                    <span class="route-value" id="resultDashDistanceShortest">-</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill shortest" id="resultDashDistanceBarShortest"></div>
                  </div>
                </div>
                <div class="bar-item">
                  <div class="bar-header">
                    <span class="route-type lowest" data-i18n="lowest">低暴露路徑</span>
                    <span class="route-value" id="resultDashDistanceLowest">-</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill lowest" id="resultDashDistanceBarLowest"></div>
                  </div>
                </div>
              </div>
              <div class="distance-increase-info">
                <span class="increase-label" data-i18n="distanceIncrease">距離增加</span>
                <span class="increase-value" id="resultDashDistanceIncrease">-</span>
                <span class="increase-unit" id="resultDashDistanceUnit">公尺</span>
              </div>
            </div>

            <!-- 時間比較卡片 -->
            <div class="result-dashboard-card">
              <h4 class="card-title" data-i18n="timeComparison">⏱️ 時間比較</h4>
              <div class="comparison-bars">
                <div class="bar-item">
                  <div class="bar-header">
                    <span class="route-type shortest" data-i18n="shortest">最短路徑</span>
                    <span class="route-value" id="resultDashTimeShortest">-</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill shortest" id="resultDashTimeBarShortest"></div>
                  </div>
                </div>
                <div class="bar-item">
                  <div class="bar-header">
                    <span class="route-type lowest" data-i18n="lowest">低暴露路徑</span>
                    <span class="route-value" id="resultDashTimeLowest">-</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill lowest" id="resultDashTimeBarLowest"></div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 錯誤提示 -->
  <div id="error-box" class="error-card" hidden style="display: none;">
    <p id="error-msg">錯誤訊息</p>
    <button id="error-close" class="error-close">✕</button>
  </div>

  <!-- 使用說明彈出視窗 -->
  <div id="help-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="help-modal-title">關於我們 | 使用說明</h3>
        <button id="close-help" class="close-btn">✕</button>
      </div>
      <div class="modal-body">
        <div id="help-content-commute">
          <!-- Logo 區域 -->
          <div class="help-section logo-section">
            <div class="logo-container">
              <img src="/static/logo/環境部_橫向.png" alt="環境部" class="logo-img">
              <img src="/static/logo/成大_白色水平.jpg" alt="國立成功大學" class="logo-img">
              <img src="/static/logo/實驗室_紅色長方形.jpg" alt="實驗室" class="logo-img">
              <img src="/static/logo/北捷文字logo_去背.png" alt="台北捷運" class="logo-img">
            </div>
          </div>
          
          <!-- 使用說明按鈕區域 -->
          <div class="help-section button-section">
            <button id="commute-help-btn" class="help-mode-btn">通勤模式使用說明</button>
            <button id="metro-help-btn" class="help-mode-btn">捷運模式使用說明</button>
          </div>
          
          <!-- 關於團隊介紹 -->
          <div class="help-section">
            <h5>開發團隊</h5>
            <p>© 2025 許家瑋 林祐如｜國立成功大學 測量及空間資訊學系｜指導老師：吳治達 教授</p>
            <p>📧 聯絡信箱：p68111509@gs.ncku.edu.tw</p>
          </div>
          
          <div class="help-section">
            <h5>資料來源</h5>
            <p>部分空氣汙染空間資訊參考自環境部公開資料</p>
          </div>
          
          <div class="help-section">
            <h5>版權聲明</h5>
            <p>本系統僅供展示與研究用途，禁止未經授權之下載、修改、或商業使用。</p>
            <p>所有原始碼、資料與介面設計，皆為作者智慧財產，保留所有權利</p>
          </div>
        </div>
        
        <div id="help-content-metro">
          <!-- Logo 區域 -->
          <div class="help-section logo-section">
            <div class="logo-container">
              <img src="/static/logo/環境部_橫向.png" alt="環境部" class="logo-img">
              <img src="/static/logo/成大_白色水平.jpg" alt="國立成功大學" class="logo-img">
              <img src="/static/logo/實驗室_紅色長方形.jpg" alt="實驗室" class="logo-img">
              <img src="/static/logo/北捷文字logo_去背.png" alt="台北捷運" class="logo-img">
            </div>
          </div>
          
          <!-- 使用說明按鈕區域 -->
          <div class="help-section button-section">
            <button id="commute-help-btn-metro" class="help-mode-btn">通勤模式使用說明</button>
            <button id="metro-help-btn-metro" class="help-mode-btn">捷運模式使用說明</button>
          </div>
          
          <!-- 關於團隊介紹 -->
          <div class="help-section">
            <h5>開發團隊</h5>
            <p>© 2025 許家瑋 林祐如｜國立成功大學 測量及空間資訊學系｜指導老師：吳治達 教授</p>
            <p>📧 聯絡信箱：p68111509@gs.ncku.edu.tw</p>
          </div>
          
          <div class="help-section">
            <h5>資料來源</h5>
            <p>部分空氣汙染空間資訊參考自環境部公開資料</p>
          </div>
          
          <div class="help-section">
            <h5>版權聲明</h5>
            <p>本系統僅供展示與研究用途，禁止未經授權之下載、修改、或商業使用。</p>
            <p>所有原始碼、資料與介面設計，皆為作者智慧財產，保留所有權利</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 通勤模式使用說明彈窗 -->
  <div id="commute-help-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>通勤模式使用說明</h3>
        <button id="close-commute-help" class="close-btn">✕</button>
      </div>
      <div class="modal-body">
        <div class="help-section">
          <h5>🚗 功能概述</h5>
          <p>通勤模式提供智能路徑規劃功能，幫助您找到最舒適、最健康的出行路線，避開高污染區域。</p>
        </div>
        
        <div class="help-section">
          <h5>🎯 使用步驟</h5>
          <p><strong>步驟一：</strong>輸入起點和終點地址，或直接在地圖上點擊選擇位置</p>
          <p><strong>步驟二：</strong>選擇交通方式（單車、步行）</p>
          <p><strong>步驟三：</strong>點擊「規劃路徑」按鈕</p>
          <p><strong>步驟四：</strong>查看路徑比較結果，包括最短路徑和低暴露路徑</p>
        </div>
        
        <div class="help-section">
          <h5>🗺️ 地圖功能</h5>
          <p><strong>疊加圖層：</strong>可選擇 PM₂.₅、NO₂、氣溫等空氣品質圖層</p>
          <p><strong>底圖樣式：</strong>提供淡雅、簡潔、深色、標準等多種地圖樣式</p>
          <p><strong>路徑顯示：</strong>藍色粗線為最短路徑，綠色粗虛線為低暴露路徑</p>
        </div>
        
        <div class="help-section">
          <h5>📊 路徑比較</h5>
          <p>系統會比較兩條路徑的距離、時間、空氣品質暴露程度，並計算改善率，幫助您做出最佳選擇。</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 捷運模式使用說明彈窗 -->
  <div id="metro-help-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>捷運模式使用說明</h3>
        <button id="close-metro-help" class="close-btn">✕</button>
      </div>
      <div class="modal-body">
        <div class="help-section">
          <h5>🚇 功能概述</h5>
          <p>捷運模式提供台北捷運路線圖，可查看各站出口資訊並規劃到附近景點的最佳路徑。</p>
        </div>
        
        <div class="help-section">
          <h5>🎯 使用步驟</h5>
          <p><strong>步驟一：</strong>點擊捷運地圖上的任一站點</p>
          <p><strong>步驟二：</strong>在彈出視窗中選擇出口</p>
          <p><strong>步驟三：</strong>選擇想前往的附近景點</p>
          <p><strong>步驟四：</strong>點擊「開始導航」查看路徑規劃</p>
        </div>
        
        <div class="help-section">
          <h5>📍 支援站點</h5>
          <p>目前支援象山站，提供3個出口選擇和2個熱門景點（豹山步道登山口、富邦美術館）。</p>
        </div>
        
        <div class="help-section">
          <h5>🗺️ 路徑規劃</h5>
          <p>系統會計算從選定出口到景點的最短路徑和低暴露路徑，並提供詳細的距離、時間和空氣品質分析。</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 改善率說明彈窗 -->
  <div id="improvement-help-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content improvement-help-content">
      <div class="modal-header">
        <h3 data-i18n="improvementRateHelpTitle">改善率計算說明</h3>
        <button class="close-modal" id="closeImprovementHelp">✕</button>
      </div>
      <div class="modal-body">
        <div class="help-section">
          <h5 data-i18n="improvementRateFormula">📊 計算公式</h5>
          <div class="formula-container">
            <div class="formula-box">
              <div class="formula-text">
                <strong data-i18n="improvementRateFormulaText">改善率 = (最短路徑暴露 - 低暴露路徑暴露) ÷ 最短路徑暴露 × 100%</strong>
              </div>
            </div>
          </div>
        </div>
        
        <div class="help-section">
          <h5 data-i18n="improvementRateExplanation">🔍 說明</h5>
          <ul>
            <li data-i18n="improvementRateDesc1">改善率表示低暴露路徑相比最短路徑在空氣污染暴露方面的改善程度</li>
            <li data-i18n="improvementRateDesc2">數值越高表示空氣品質改善效果越好</li>
            <li data-i18n="improvementRateDesc3">暴露量 = PM₂.₅濃度 × 路徑長度</li>
            <li data-i18n="improvementRateDesc4">單位：μg/m³·min（微克每立方公尺每分鐘）</li>
          </ul>
        </div>
        
        <div class="help-section">
          <h5 data-i18n="improvementRateExample">💡 範例</h5>
          <div class="example-container">
            <p data-i18n="improvementRateExampleText">假設最短路徑暴露為 100 μg/m³·min，低暴露路徑暴露為 80 μg/m³·min</p>
            <p data-i18n="improvementRateExampleCalc">改善率 = (100 - 80) ÷ 100 × 100% = 20%</p>
            <p data-i18n="improvementRateExampleResult">表示低暴露路徑比最短路徑減少了 20% 的空氣污染暴露</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="vendor/leaflet/leaflet.js"></script>
  <script src="app.js"></script>
</body>
</html>

